# –ö–∞—Ä—Ç–∞ —Ä–æ—É—Ç–æ–≤ ‚Äî LMS

> Next.js App Router. –£–∫–∞–∑–∞–Ω –ø—É—Ç—å, –¥–æ—Å—Ç—É–ø –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ä–æ—É—Ç–∞.

---

## –õ–µ–≥–µ–Ω–¥–∞ –¥–æ—Å—Ç—É–ø–∞

| –û–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ | –ö—Ç–æ |
|-------------|-----|
| üåê Public | –ë–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ |
| üë§ Any | –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| üîë Admin | –†–æ–ª—å ADMIN |
| ‚úèÔ∏è Creator | ADMIN –∏–ª–∏ WORKER —Å canCreateCourses = true |
| üìñ Worker | –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π (–≤ —Ç.—á. Admin) |

---

## –ü—É–±–ª–∏—á–Ω—ã–µ —Ä–æ—É—Ç—ã

| –†–æ—É—Ç | –î–æ—Å—Ç—É–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|----------|
| `/` | üåê Public | –†–µ–¥–∏—Ä–µ–∫—Ç: –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí `/dashboard`, –Ω–µ—Ç ‚Üí `/login` |
| `/login` | üåê Public | –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ |
| `/register` | üåê Public | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ (Admin —Å–æ–∑–¥–∞—ë—Ç –∞–∫–∫–∞—É–Ω—Ç) |
| `/invite/[token]` | üåê Public | –°–∞–º–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ –ø–æ –∏–Ω–≤–∞–π—Ç-—Å—Å—ã–ª–∫–µ |

---

## –û–±—â–∏–π –¥–∞—à–±–æ—Ä–¥

| –†–æ—É—Ç | –î–æ—Å—Ç—É–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|----------|
| `/dashboard` | üë§ Any | –†–µ–¥–∏—Ä–µ–∫—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏: Admin ‚Üí `/admin`, Worker ‚Üí `/my-courses` |

---

## –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

| –†–æ—É—Ç | –î–æ—Å—Ç—É–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|----------|
| `/admin` | üîë Admin | –û–±–∑–æ—Ä: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏ |
| `/admin/users` | üîë Admin | –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (—Å–∫—Ä—ã—Ç—ã —É–≤–æ–ª–µ–Ω–Ω—ã–µ) |
| `/admin/users/new` | üîë Admin | –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–Ω–≤–∞–π—Ç-—Å—Å—ã–ª–∫–∏ |
| `/admin/users/[id]` | üîë Admin | –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–≤–æ–ª—å–Ω–µ–Ω–∏–µ, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏ |
| `/admin/subscription` | üîë Admin | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–æ–π, –Æ–ö–∞—Å—Å–∞ |

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞–º–∏ (Creator)

| –†–æ—É—Ç | –î–æ—Å—Ç—É–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|----------|
| `/courses` | ‚úèÔ∏è Creator | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫—É—Ä—Å–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏ |
| `/courses/new` | ‚úèÔ∏è Creator | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫—É—Ä—Å–∞ |
| `/courses/[id]` | ‚úèÔ∏è Creator | –†–µ–¥–∞–∫—Ç–æ—Ä –∫—É—Ä—Å–∞: –∑–∞–¥–∞–Ω–∏—è, —Ñ–∞–π–ª—ã, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| `/courses/[id]/assign` | ‚úèÔ∏è Creator | –í—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫—É—Ä—Å–∞ |

---

## –ü–æ—Ä—Ç–∞–ª —Ä–∞–±–æ—Ç–Ω–∏–∫–∞

| –†–æ—É—Ç | –î–æ—Å—Ç—É–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|----------|
| `/my-courses` | üìñ Worker | –°–ø–∏—Å–æ–∫ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ —Å —Å—Ç–∞—Ç—É—Å–∞–º–∏ |
| `/my-courses/[id]` | üìñ Worker | –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫—É—Ä—Å–∞: –∑–∞–¥–∞–Ω–∏—è, —Ñ–∞–π–ª—ã, –∫–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç—å" |
| `/notifications` | üìñ Worker | –°–ø–∏—Å–æ–∫ in-app —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |

---

## API —Ä–æ—É—Ç—ã (Next.js Route Handlers)

### Auth
| –†–æ—É—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|----------|
| `/api/auth/[...nextauth]` | GET/POST | Auth.js ‚Äî –ª–æ–≥–∏–Ω, –ª–æ–≥–∞—É—Ç, —Å–µ—Å—Å–∏—è |

### –ö–æ–º–ø–∞–Ω–∏–∏
| –†–æ—É—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|----------|
| `/api/companies` | POST | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ |

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
| –†–æ—É—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|----------|
| `/api/users` | GET | –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–æ–º–ø–∞–Ω–∏–∏ |
| `/api/users` | POST | –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–≤–∞–π—Ç |
| `/api/users/[id]` | PATCH | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–§–ò–û, email, —Ä–æ–ª—å) |
| `/api/users/[id]/fire` | POST | –£–≤–æ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `/api/users/[id]/invite` | POST | –ü–µ—Ä–µ–≤—ã—Å–ª–∞—Ç—å / –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–≤–∞–π—Ç-—Å—Å—ã–ª–∫—É |

### –ò–Ω–≤–∞–π—Ç—ã
| –†–æ—É—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|----------|
| `/api/invite/[token]` | GET | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ |
| `/api/invite/[token]` | POST | –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é (–ª–æ–≥–∏–Ω + –ø–∞—Ä–æ–ª—å) |

### –ö—É—Ä—Å—ã
| –†–æ—É—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|----------|
| `/api/courses` | GET | –°–ø–∏—Å–æ–∫ –∫—É—Ä—Å–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏ |
| `/api/courses` | POST | –°–æ–∑–¥–∞—Ç—å –∫—É—Ä—Å |
| `/api/courses/[id]` | GET | –ü–æ–ª—É—á–∏—Ç—å –∫—É—Ä—Å —Å –∑–∞–¥–∞–Ω–∏—è–º–∏ –∏ —Ñ–∞–π–ª–∞–º–∏ |
| `/api/courses/[id]` | PATCH | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫—É—Ä—Å |
| `/api/courses/[id]` | DELETE | –£–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å |
| `/api/courses/[id]/tasks` | POST | –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ |
| `/api/courses/[id]/tasks/[taskId]` | PATCH | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ |
| `/api/courses/[id]/tasks/[taskId]` | DELETE | –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ |
| `/api/courses/[id]/assign` | POST | –ù–∞–∑–Ω–∞—á–∏—Ç—å –∫—É—Ä—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º |

### –§–∞–π–ª—ã
| –†–æ—É—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|----------|
| `/api/files/upload` | POST | –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –≤ S3, –≤–µ—Ä–Ω—É—Ç—å fileKey |
| `/api/files/[id]` | DELETE | –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –∏–∑ S3 –∏ –ë–î |
| `/api/files/[id]/download` | GET | Signed URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ –∏–∑ S3 |

### –ü—Ä–æ–≥—Ä–µ—Å—Å —Ä–∞–±–æ—Ç–Ω–∏–∫–∞
| –†–æ—É—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|----------|
| `/api/my-courses` | GET | –ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –∫—É—Ä—Å—ã —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `/api/my-courses/[id]/start` | POST | –û—Ç–∫—Ä—ã–ª –∫—É—Ä—Å ‚Üí —Å—Ç–∞—Ç—É—Å IN_PROGRESS |
| `/api/my-courses/[id]/complete` | POST | –ù–∞–∂–∞–ª "–ó–∞–≤–µ—Ä—à–∏—Ç—å" ‚Üí —Å—Ç–∞—Ç—É—Å COMPLETED |

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
| –†–æ—É—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|----------|
| `/api/notifications` | GET | –°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—Å —Ñ–∏–ª—å—Ç—Ä–æ–º isRead) |
| `/api/notifications/read` | POST | –ü–æ–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ |

### –ü–æ–¥–ø–∏—Å–∫–∞
| –†–æ—É—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|----------|
| `/api/subscription/create` | POST | –ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞—Ç—ë–∂ –≤ –Æ–ö–∞—Å—Å–µ |
| `/api/subscription/webhook` | POST | Webhook –æ—Ç –Æ–ö–∞—Å—Å—ã (–æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å) |

---

## Middleware (src/middleware.ts)

–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º —Ä–æ—É—Ç–∞–º –∫—Ä–æ–º–µ –ø—É–±–ª–∏—á–Ω—ã—Ö.

1. –ù–µ—Ç —Å–µ—Å—Å–∏–∏ ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`
2. –ü–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–ª–∞ ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/admin/subscription` (–∫—Ä–æ–º–µ —Å–∞–º–æ–≥–æ —ç—Ç–æ–≥–æ —Ä–æ—É—Ç–∞ –∏ API webhook)
3. –†–æ—É—Ç `/admin/*` + —Ä–æ–ª—å –Ω–µ ADMIN ‚Üí 403
4. –†–æ—É—Ç `/courses/*` + canCreateCourses = false ‚Üí 403
5. –ò–∑–æ–ª—è—Ü–∏—è –ø–æ tenantId: –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –¥–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ `session.user.companyId`
